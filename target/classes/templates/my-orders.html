<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê∆°n H√†ng C·ªßa T√¥i - TapHoaPtit.online</title>
    <style>
        /* CSS styles ƒë√£ ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        
        /* Header styles */
        .header-top {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 0;
        }
        
        .header-top .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-main {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-main .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 32px;
        }
        
        .search-box {
            flex: 1;
            max-width: 500px;
            margin: 0 30px;
        }
        
        .search-box form {
            display: flex;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px 0 0 25px;
            font-size: 14px;
        }
        
        .search-box button {
            padding: 12px 25px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 0 25px 25px 0;
            cursor: pointer;
            font-size: 16px;
        }
        
        .cart-link {
            font-size: 28px;
            color: #667eea;
            text-decoration: none;
            position: relative;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            font-size: 12px;
            padding: 3px 7px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .user-welcome {
            color: white;
            margin-right: 15px;
        }
        
        .btn-logout {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn-logout:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Nav Menu */
        .nav-menu {
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .nav-menu .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .nav-menu ul {
            list-style: none;
            display: flex;
            gap: 30px;
            padding: 15px 0;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            color: #667eea;
        }
        
        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        
        .page-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Alert Messages */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        
        /* Orders */
        .orders-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .order-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .order-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .order-id {
            font-size: 18px;
            font-weight: bold;
        }
        
        .order-date {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .order-body {
            padding: 20px;
        }
        
        .order-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .info-label {
            font-size: 13px;
            color: #666;
        }
        
        .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
        }
        
        .order-items {
            margin-bottom: 20px;
        }
        
        .order-items h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .order-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .item-icon {
            width: 60px;
            height: 60px;
            overflow: hidden;
            border-radius: 5px;
            border: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .item-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .item-icon span {
            font-size: 30px;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .item-price {
            color: #666;
            font-size: 14px;
        }
        
        .item-quantity {
            color: #667eea;
            font-weight: 600;
        }
        
        .item-total {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
        }
        
        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .order-total {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        
        .order-total span {
            color: #667eea;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-confirmed {
            background: #cfe2ff;
            color: #084298;
        }
        
        .status-shipping {
            background: #d1e7dd;
            color: #0f5132;
        }
        
        .status-completed {
            background: #d1e7dd;
            color: #0a3622;
            border: 2px solid #198754;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #842029;
        }
        
        .status-cancel-requested {
            background: #fff3cd;
            color: #664d03;
            border: 2px solid #ffc107;
        }
        
        /* Order Actions */
        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .btn-cancel-order {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-cancel-order:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .btn-request-cancel {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-request-cancel:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        /* Empty State */
        .empty-orders {
            background: white;
            border-radius: 10px;
            padding: 60px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .empty-orders-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .empty-orders h2 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .empty-orders p {
            color: #666;
            margin-bottom: 30px;
        }
        
        .btn-primary {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: transform 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        
        /* Footer */
        .footer {
            background: #2d3436;
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
        }
        
        .footer .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 20px;
        }
        
        .footer h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .footer p, .footer a {
            color: #b2bec3;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .footer a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #404040;
            color: #b2bec3;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Header Top -->
    <div class="header-top">
        <div class="container">
            <div>üìû Hotline: 1900 1234 | üìß support@taphoaptit.online</div>
            <div>
                <span class="user-welcome">Xin ch√†o, <strong th:text="${username}"></strong>!</span>
                <a href="/logout" class="btn-logout">ƒêƒÉng xu·∫•t</a>
            </div>
        </div>
    </div>
    
    <!-- Header Main -->
    <div class="header-main">
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-icon">ü™ô</span>
                <span>TapHoaPtit.online</span>
            </a>
            <div class="search-box">
                <form action="/search" method="get">
                    <input type="text" name="keyword" placeholder="T√¨m ki·∫øm..." required>
                    <button type="submit">üîç</button>
                </form>
            </div>
            <a href="/cart" class="cart-link">
                üõí
                <span class="cart-badge" th:if="${cartCount > 0}" th:text="${cartCount}">0</span>
            </a>
        </div>
    </div>
    
    <!-- Nav Menu -->
    <div class="nav-menu">
        <div class="container">
            <ul>
                <li><a href="/">üè† Trang ch·ªß</a></li>
                <li><a href="/my-orders" class="active">üì¶ ƒê∆°n h√†ng c·ªßa t√¥i</a></li>
                <li><a href="/cart">üõí Gi·ªè h√†ng</a></li>
            </ul>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <h1 class="page-title">üì¶ ƒê∆°n H√†ng C·ªßa T√¥i</h1>
        
        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        <div th:if="${warning}" class="alert alert-warning" th:text="${warning}"></div>
        <div th:if="${info}" class="alert alert-info" th:text="${info}"></div>
        
        <!-- N·∫øu kh√¥ng c√≥ ƒë∆°n h√†ng -->
        <div th:if="${orders.size() == 0}" class="empty-orders">
            <div class="empty-orders-icon">üî≠</div>
            <h2>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h2>
            <p>B·∫°n ch∆∞a ƒë·∫∑t ƒë∆°n h√†ng n√†o. H√£y b·∫Øt ƒë·∫ßu mua s·∫Øm ngay!</p>
            <a href="/" class="btn-primary">üõçÔ∏è Mua s·∫Øm ngay</a>
        </div>
        
        <!-- Danh s√°ch ƒë∆°n h√†ng -->
        <div th:if="${orders.size() > 0}" class="orders-container">
            <div class="order-card" th:each="order : ${orders}">
                <div class="order-header">
                    <div>
                        <div class="order-id" th:text="'ƒê∆°n h√†ng #' + ${order.id}">ƒê∆°n h√†ng #1</div>
                        <div class="order-date" th:text="'ƒê·∫∑t ng√†y: ' + ${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">
                            ƒê·∫∑t ng√†y: 09/11/2025 10:30
                        </div>
                    </div>
                    <div>
                        <span class="status-badge" 
                              th:classappend="${order.status == 'PENDING' ? 'status-pending' : 
                                               order.status == 'CONFIRMED' ? 'status-confirmed' :
                                               order.status == 'SHIPPING' ? 'status-shipping' :
                                               order.status == 'COMPLETED' ? 'status-completed' :
                                               order.status == 'CANCEL_REQUESTED' ? 'status-cancel-requested' : 'status-cancelled'}"
                              th:text="${order.status == 'PENDING' ? '‚è≥ Ch·ªù x·ª≠ l√Ω' : 
                                       order.status == 'CONFIRMED' ? '‚úÖ ƒê√£ x√°c nh·∫≠n' :
                                       order.status == 'SHIPPING' ? 'üöö ƒêang giao' :
                                       order.status == 'COMPLETED' ? '‚úÖ Ho√†n th√†nh' :
                                       order.status == 'CANCEL_REQUESTED' ? '‚è≥ Ch·ªù h·ªßy' : '‚ùå ƒê√£ h·ªßy'}">
                            ‚è≥ Ch·ªù x·ª≠ l√Ω
                        </span>
                    </div>
                </div>
                
                <div class="order-body">
                    <div class="order-info">
                        <div class="info-item">
                            <div class="info-label">üìû S·ªë ƒëi·ªán tho·∫°i</div>
                            <div class="info-value" th:text="${order.phone}">0123456789</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üìç ƒê·ªãa ch·ªâ giao h√†ng</div>
                            <div class="info-value" th:text="${order.address}">H√† N·ªôi</div>
                        </div>
                        <div class="info-item" th:if="${order.note}">
                            <div class="info-label">üìù Ghi ch√∫</div>
                            <div class="info-value" th:text="${order.note}">-</div>
                        </div>
                        <div class="info-item" th:if="${order.couponCode}">
                            <div class="info-label">üéüÔ∏è M√£ gi·∫£m gi√°</div>
                            <div class="info-value" th:text="${order.couponCode}">NEWBIE</div>
                        </div>
                    </div>
                    
                    <div class="order-items">
                        <h4>üìã S·∫£n ph·∫©m ƒë√£ ƒë·∫∑t:</h4>
                        <div class="order-item" th:each="item : ${order.orderItems}">
                            <div class="item-icon">
                                <img th:if="${item.product.imageUrl != null and item.product.imageUrl.contains('.')}"
                                     th:src="@{'/images/' + ${item.product.imageUrl}}"
                                     alt="SP">
                                <span th:unless="${item.product.imageUrl != null and item.product.imageUrl.contains('.')}"
                                      th:text="${item.product.imageUrl}">üõí</span>
                            </div>
                            <div class="item-details">
                                <div class="item-name" th:text="${item.product.name}">G·∫°o ST25</div>
                                <div class="item-price">
                                    <span th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">119,000‚Ç´</span>
                                    <span> x </span>
                                    <span class="item-quantity" th:text="${item.quantity}">2</span>
                                </div>
                            </div>
                            <div class="item-total" 
                                 th:text="${#numbers.formatDecimal(item.price * item.quantity, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">
                                238,000‚Ç´
                            </div>
                        </div>
                    </div>
                    
                    <div class="order-footer">
                        <div>
                            <div class="order-total">
                                T·ªïng c·ªông: <span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">238,000‚Ç´</span>
                            </div>
                            <div th:if="${order.discountAmount != null and order.discountAmount > 0}" 
                                 style="font-size: 14px; color: #27ae60; margin-top: 5px;">
                                (ƒê√£ gi·∫£m <span th:text="${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">10,200‚Ç´</span>)
                            </div>
                        </div>
                        
                        <!-- N√∫t h·ªßy ƒë∆°n h√†ng -->
                        <div class="order-actions">
                            <!-- ƒê∆°n PENDING: H·ªßy tr·ª±c ti·∫øp -->
                            <form th:if="${order.status == 'PENDING'}" 
                                  th:action="@{/order/cancel/{id}(id=${order.id})}" 
                                  method="post"
                                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?');">
                                <button type="submit" class="btn-cancel-order">
                                    ‚ùå H·ªßy ƒë∆°n h√†ng
                                </button>
                            </form>
                            
                            <!-- ƒê∆°n CONFIRMED: Y√™u c·∫ßu h·ªßy -->
                            <form th:if="${order.status == 'CONFIRMED'}" 
                                  th:action="@{/order/cancel/{id}(id=${order.id})}" 
                                  method="post"
                                  onsubmit="return confirm('G·ª≠i y√™u c·∫ßu h·ªßy ƒë∆°n h√†ng? C·ª≠a h√†ng s·∫Ω xem x√©t v√† ph·∫£n h·ªìi s·ªõm nh·∫•t.');">
                                <button type="submit" class="btn-request-cancel">
                                    ‚è≥ Y√™u c·∫ßu h·ªßy ƒë∆°n
                                </button>
                            </form>
                            
                            <!-- ƒê∆°n CANCEL_REQUESTED: Hi·ªÉn th·ªã th√¥ng b√°o -->
                            <div th:if="${order.status == 'CANCEL_REQUESTED'}" 
                                 style="color: #f59e0b; font-size: 14px; font-weight: 600;">
                                ‚è≥ ƒêang ch·ªù c·ª≠a h√†ng x√°c nh·∫≠n h·ªßy...
                            </div>
                            
                            <!-- ƒê∆°n SHIPPING, COMPLETED: Kh√¥ng cho h·ªßy -->
                            <div th:if="${order.status == 'SHIPPING' or order.status == 'COMPLETED'}" 
                                 style="color: #666; font-size: 14px;">
                                <span th:if="${order.status == 'SHIPPING'}">üöö ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c giao, kh√¥ng th·ªÉ h·ªßy</span>
                                <span th:if="${order.status == 'COMPLETED'}">‚úÖ ƒê∆°n h√†ng ƒë√£ ho√†n th√†nh</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div>
                <h3>ü™ô V·ªÅ TapHoaPtit.online</h3>
                <p>T·∫°p h√≥a tr·ª±c tuy·∫øn h√†ng ƒë·∫ßu Vi·ªát Nam</p>
                <p>Giao h√†ng nhanh - Gi√° c·∫£ h·ª£p l√Ω</p>
            </div>
            <div>
                <h3>üìã H·ªó tr·ª£ kh√°ch h√†ng</h3>
                <a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a>
                <a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a>
            </div>
            <div>
                <h3>üìû Li√™n h·ªá</h3>
                <p>Hotline: 1900 1234</p>
                <p>Email: support@taphoaptit.online</p>
            </div>
        </div>
        <div class="copyright">
            ¬© 2025 TapHoaPtit.online - T·∫°p h√≥a tr·ª±c tuy·∫øn
        </div>
    </div>
</body>
</html>