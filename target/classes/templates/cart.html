<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng - TapHoaPtit.online</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/cart.css}">
</head>
<body>
    <!-- Header Top -->
    <div class="header-top">
        <div class="container">
            <div>üìû Hotline: 1900 1234 | üìß support@taphoaptit.online</div>
            <div>
                <span class="user-welcome">Xin ch√†o, <strong th:text="${username}"></strong>!</span>
                <a href="/logout" class="btn-logout">ƒêƒÉng xu·∫•t</a>
            </div>
        </div>
    </div>
    
    <div class="header-main">
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-icon">üè™</span>
                <span>TapHoaPtit.online</span>
            </a>
            <div class="search-box">
                <form action="/search" method="get">
                    <input type="text" name="keyword" placeholder="T√¨m ki·∫øm..." required>
                    <button type="submit">üîç</button>
                </form>
            </div>
            <a href="/cart" class="cart-link">
                üõí
                <span class="cart-badge" th:if="${cartCount > 0}" th:text="${cartCount}">0</span>
            </a>
        </div>
    </div>
    
    <!-- Main -->
    <div class="main-content">
        <h1 class="page-title">
            <span>üõí Gi·ªè h√†ng c·ªßa b·∫°n</span>
            <span class="cart-badge-summary" th:if="${cartCount > 0}" th:text="${cartCount} + ' s·∫£n ph·∫©m'">0 s·∫£n ph·∫©m</span>
        </h1>
        
        <!-- Gi·ªè h√†ng tr·ªëng -->
        <div class="cart-container" th:if="${cartItems.size() == 0}">
            <div class="empty-cart">
                <div class="empty-cart-icon">üõí</div>
                <h2>Gi·ªè h√†ng tr·ªëng</h2>
                <p>B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng</p>
                <a href="/" class="continue-btn">üõçÔ∏è Ti·∫øp t·ª•c mua s·∫Øm</a>
            </div>
        </div>
        
        <!-- C√≥ s·∫£n ph·∫©m -->
        <div class="cart-container" th:if="${cartItems.size() > 0}">
            <!-- Cart Items -->
            <div class="cart-items-section">
                <h3>S·∫£n ph·∫©m trong gi·ªè</h3>
                
                <div class="cart-item" th:each="item : ${cartItems}">
                    <div class="item-image">
                        <div class="item-img" th:text="${item.product.imageUrl}">üì¶</div>
                    </div>
                    
                    <div class="item-details">
                        <div class="item-name" th:text="${item.product.name}">T√™n s·∫£n ph·∫©m</div>
                        <div class="item-price" th:data-price="${item.product.price}" 
                             th:text="${#numbers.formatDecimal(item.product.price, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</div>
                        
                        <div class="item-actions">
                            <div class="item-quantity">
                                <form th:action="@{/cart/update/{id}(id=${item.id})}" method="post" style="display:inline;">
                                    <button type="button" class="quantity-btn decrease-btn" th:data-id="${item.id}">‚àí</button>
                                    <input type="number" name="quantity" th:value="${item.quantity}" min="1" th:id="'qty-' + ${item.id}" readonly>
                                    <button type="button" class="quantity-btn increase-btn" th:data-id="${item.id}">+</button>
                                </form>
                            </div>
                            
                            <form th:action="@{/cart/remove/{id}(id=${item.id})}" method="post" style="display:inline;">
                                <button type="submit" class="remove-btn">üóëÔ∏è X√≥a</button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="item-right">
                        <div class="item-total" th:text="${#numbers.formatDecimal(item.product.price * item.quantity, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</div>
                    </div>
                </div>
            </div>
            
            <!-- Cart Summary -->
            <div class="cart-summary">
                <h3>T√≥m t·∫Øt ƒë∆°n h√†ng</h3>
                
                <div class="summary-row subtotal">
                    <span>T·∫°m t√≠nh:</span>
                    <span th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</span>
                </div>
                
                <div class="summary-row shipping">
                    <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                    <span style="color: #27ae60; font-weight: 600;">Mi·ªÖn ph√≠</span>
                </div>
                
                <div class="coupon-section">
                    <input type="text" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°" id="coupon-input">
                    <button class="apply-coupon-btn">√Åp d·ª•ng</button>
                </div>
                
                <div class="summary-row total">
                    <span>T·ªïng c·ªông:</span>
                    <span class="total-price" th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</span>
                </div>
                
                <!-- N√öT ƒê·∫∂T H√ÄNG -->
                <button type="button" class="checkout-btn" onclick="openOrderModal()">
                    üì¶ ƒê·∫∑t h√†ng
                </button>
                
                <a href="/" class="continue-shopping">‚Üê Ti·∫øp t·ª•c mua s·∫Øm</a>
            </div>
        </div>
    </div>
    
    <!-- MODAL ƒê·∫∂T H√ÄNG -->
    <div id="orderModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeOrderModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì¶ X√°c nh·∫≠n th√¥ng tin giao h√†ng</h2>
                <button type="button" class="modal-close" onclick="closeOrderModal()">√ó</button>
            </div>
            
            <form id="orderForm" action="/order/place" method="post">
                <div class="form-group">
                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i: <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..." required>
                </div>
                
                <div class="form-group">
                    <label for="address">ƒê·ªãa ch·ªâ giao h√†ng: <span class="required">*</span></label>
                    <textarea id="address" name="address" rows="3" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="note">Ghi ch√∫ (t√πy ch·ªçn):</label>
                    <textarea id="note" name="note" rows="2" placeholder="Ghi ch√∫ cho ƒë∆°n h√†ng..."></textarea>
                </div>
                
                <div class="order-summary-modal">
                    <div class="summary-row">
                        <span>T·ªïng ti·ªÅn:</span>
                        <span class="total-price" th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeOrderModal()">H·ªßy</button>
                    <button type="submit" class="btn-confirm">‚úì X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div>
                <h3>V·ªÅ TapHoaPtit.online</h3>
                <p>T·∫°p h√≥a tr·ª±c tuy·∫øn h√†ng ƒë·∫ßu Vi·ªát Nam</p>
                <p>Giao h√†ng nhanh - Gi√° c·∫£ h·ª£p l√Ω</p>
            </div>
            <div>
                <h3>H·ªó tr·ª£ kh√°ch h√†ng</h3>
                <a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a>
                <a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a>
                <a href="#">Ph∆∞∆°ng th·ª©c thanh to√°n</a>
            </div>
            <div>
                <h3>Li√™n h·ªá</h3>
                <p>üìû Hotline: 1900 1234</p>
                <p>üìß Email: support@taphoaptit.online</p>
            </div>
        </div>
        <div class="copyright">
            ¬© 2024 TapHoaPtit.online - T·∫°p h√≥a tr·ª±c tuy·∫øn
        </div>
    </div>
    
    <script th:src="@{/js/cart.js}"></script>
    <script>
        // Inline script ƒë·ªÉ ƒë·∫£m b·∫£o functions ho·∫°t ƒë·ªông
        function openOrderModal() {
            console.log('Opening modal...');
            const modal = document.getElementById('orderModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                console.log('Modal opened!');
            } else {
                console.error('Modal not found!');
            }
        }
        
        function closeOrderModal() {
            console.log('Closing modal...');
            const modal = document.getElementById('orderModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                console.log('Modal closed!');
            }
        }
        
        // Close on ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeOrderModal();
            }
        });
    </script>
</body>
</html>